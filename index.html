<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tree Shop</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav>
        <a href="#" class="logo"> Tree Shop</a>
         
    </nav>
    <header>
       
    </header>

    <div class="container">
        <div class="form-container">
            <img src="./images/chau-lan-ho-diep-qua-tang-mung-xuan.jpg" alt="Tree Image">
            <div id="addTreeBtn" class="form">
                <h3>Tree Name</h3>
                <input type="text" id="treeName" placeholder="Enter tree name" required>
                <h3>Description</h3>
                <textarea id="description" rows="5" placeholder="Enter description" required></textarea>
                <h3>Image</h3>
                <input type="file" id="image" required>
                <button type="submit" class="add">Add</button>
                <button type="reset" class="reset">Reset</button>
            </div>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Id</th>
                        <th>Name</th>
                        <th>Image</th>
                        <th>Description</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be populated here -->
                </tbody>
            </table>
        </div>
    </div>

    <footer>
        <p>S·ªë 8, T√¥n Th·∫•t Thuy·∫øt, C·∫ßu Gi·∫•y, H√† N·ªôi</p>
    </footer>
    <script>
        let editingTreeId = null; // Bi·∫øn ƒë·ªÉ l∆∞u ID c·ªßa c√¢y ƒëang ƒë∆∞·ª£c s·ª≠a
    
        document.querySelector('.add').addEventListener('click', async (event) => {
            event.preventDefault(); // NgƒÉn ch·∫∑n g·ª≠i form m·∫∑c ƒë·ªãnh
            const name = document.getElementById('treeName').value;
            const description = document.getElementById('description').value;
            const imageFile = document.getElementById('image').files[0];
    
            // Ki·ªÉm tra n·∫øu thi·∫øu th√¥ng tin
            if (!name || !description || (!imageFile && !editingTreeId)) {
                alert('Please fill in all fields!');
                return;
            }
    
            const formData = new FormData();
            formData.append('name', name);
            formData.append('description', description);
            if (imageFile) formData.append('image', imageFile); // Ch·ªâ g·ª≠i ·∫£nh n·∫øu c√≥ thay ƒë·ªïi
    
            try {
                let response;
                if (editingTreeId) {
                    // N·∫øu ƒëang s·ª≠a c√¢y
                    response = await fetch(`http://localhost:5000/api/trees/${editingTreeId}`, {
                        method: 'PUT',
                        body: formData,
                    });
                } else {
                    // N·∫øu th√™m c√¢y m·ªõi
                    response = await fetch('http://localhost:5000/api/trees', {
                        method: 'POST',
                        body: formData,
                    });
                }
    
                if (response.ok) {
                    alert(editingTreeId ? 'Tree updated successfully' : 'Tree added successfully');
                    fetchTrees(); // L√†m m·ªõi danh s√°ch c√¢y
                    resetForm(); // Reset form
                } else {
                    alert('Failed to add/update tree');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        });
    
        // Function to fetch trees and display them in the table
        async function fetchTrees() {
            try {
                const response = await fetch('http://localhost:5000/api/trees');
                const trees = await response.json();
                const tableBody = document.querySelector('tbody');
                tableBody.innerHTML = '';
    
                trees.forEach((tree, index) => {
                    const row = `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${tree.name}</td>
                            <td><img src="${tree.image}" alt="${tree.name}" width="50"></td>
                            <td>${tree.description}</td>
                            <td>
                                <button onclick="editTree('${tree._id}')">‚úèÔ∏è Edit</button>
                                <button onclick="deleteTree('${tree._id}')">üóëÔ∏è Delete</button>
                            </td>
                        </tr>
                    `;
                    tableBody.insertAdjacentHTML('beforeend', row);
                });
            } catch (error) {
                console.error('Error fetching trees:', error);
            }
        }
    
        // Function to reset the form
        function resetForm() {
            document.getElementById('treeName').value = '';
            document.getElementById('description').value = '';
            document.getElementById('image').value = '';
            editingTreeId = null;
            document.querySelector('.add').textContent = 'Add'; // ƒê·ªïi n√∫t v·ªÅ "Add"
        }
    
       // Function to edit a tree
async function editTree(id) {
    const response = await fetch(`http://localhost:5000/api/trees/${id}`);
    const tree = await response.json();

    // ƒêi·ªÅn d·ªØ li·ªáu c·ªßa c√¢y v√†o form
    document.getElementById('treeName').value = tree.name;
    document.getElementById('description').value = tree.description;
    
    // L∆∞u ID c√¢y ƒëang s·ª≠a
    editingTreeId = id;
    document.querySelector('.add').textContent = 'Update'; // ƒê·ªïi n√∫t th√†nh "Update"
}

    
        // Function to delete a tree
        async function deleteTree(id) {
            if (confirm('Are you sure you want to delete this tree?')) {
                const response = await fetch(`http://localhost:5000/api/trees/${id}`, {
                    method: 'DELETE',
                });
    
                if (response.ok) {
                    alert('Tree deleted successfully');
                    fetchTrees();
                } else {
                    alert('Failed to delete tree');
                }
            }
        }
    
        // Fetch trees when page loads
        window.onload = fetchTrees;
    </script>
    
    
</body>
</html>
